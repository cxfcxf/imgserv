#!/usr/bin/env ruby
require 'rubygems'
require 'twitter'

#NikeStore configuration
Nike_store1 = "NikeSantaMonica"
Nike_store2 = "NikeLA"


#Client_OAUTH configuration
SIEG_CONSUMER_KEY = 'iqHRpV85GFWn8A0OL1xsDg'
SIEG_CONSUMER_SECRET = 'b7BlTaem2fTAy0hLQFcVQO787TFSvwKa8cZP6KwXbc'
SIEG_OAUTH_TOKEN = '47161363-OGwUmpu44heOAoVwOCwwgOXp6I9FR6aBmoTDJFNSw'
SIEG_OAUTH_TOKEN_SECRET = 'dGwdYaHagwJRh7g5g7HPFjxPgFtKjQCc8jRiB9PoMTY'

ALLEN_CONSUMER_KEY = 'iqHRpV85GFWn8A0OL1xsDg'
ALLEN_CONSUMER_SECRET = 'b7BlTaem2fTAy0hLQFcVQO787TFSvwKa8cZP6KwXbc'
ALLEN_OAUTH_TOKEN = '47161363-RhEMG4M7VyUrNbPA4Ml6TiNXnTpo5cIG9NTuqtJid'
ALLEN_OAUTH_TOKEN_SECRET = 'uftncZu8DreP44QISpCnWm3t0PPSth49spzZxe3LgU'


@client_sieg = Twitter::Client.new(
	:consumer_key => SIEG_CONSUMER_KEY,
	:consumer_secret => SIEG_CONSUMER_SECRET,
	:oauth_token => SIEG_OAUTH_TOKEN,
	:oauth_token_secret => SIEG_OAUTH_TOKEN_SECRET
)

@client_allen = Twitter::Client.new(
	:consumer_key => ALLEN_CONSUMER_KEY,
	:consumer_secret => ALLEN_CONSUMER_SECRET,
	:oauth_token => ALLEN_OAUTH_TOKEN,
	:oauth_token_secret => ALLEN_OAUTH_TOKEN_SECRET
)

while 1
localtime = Time.now

#Nikestore 1 => NikeSantaMonica
	gettweets1 = @client_sieg.user_timeline(Nike_store1)
	time1 = gettweets1[0].created_at
	tweet01 = gettweets1[0].text

	if (tweet01 =~ /\#RSVP\ is\ now\ open\ for/) and ((localtime.to_i - time1.to_i) < 10)
		tweet01_array = tweet01.split().reverse

		code1 = String.new

		tweet01_array.each do |x| 
			if (x =~ /\#/)
				codearray1 = x.split('.')
				code1 = codearray1[0]
				break
			end
		end
		
		@client_sieg.direct_message_create("NikeSantaMonica", "#{code1}, XUEFENG CHEN, 9.5")
		@client_allen.direct_message_create("NikeSantaMonica", "#{code1}, KUANLUN WANG, 9.5")

	end

#Nikestore 2 => NikeLA
	gettweets2 = @client_allen.user_timeline(Nike_store2)
	time2 = gettweets2[0].created_at
	tweet02 = gettweets2[0].text

	if (tweet02 =~ /\#RSVP\ is\ now\ open\ for/) and ((localtime.to_i - time2.to_i) < 10)
		tweet02_array = tweet02.split().reverse

		code2 = String.new

		tweet02_array.each do |y| 
			if (y =~ /\#/)
				codearray2 = y.split('.')
				code2 = codearray2[0]
				break
			end
		end
		@client_sieg.direct_message_create("NikeLA", "#{code2}, XUEFENG CHEN, 9.5")
		@client_allen.direct_message_create("NikeLA", "#{code2}, KUANLUN WANG, 9.5")
	end

#Evert 10 secs
	sleep 10
end